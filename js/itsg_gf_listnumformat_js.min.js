function itsg_gf_list_number_format_init(){var e=itsg_gf_listnumformat_js_settings.number_format_fields,i=itsg_gf_listnumformat_js_settings.form_id;for(var t in e)if(e.hasOwnProperty(t)){var r=e[t];for(var n in r)if(r.hasOwnProperty(n)){var a=t,l=n,o="string"!==r[l].isNumberFormat?r[l].isNumberFormat:"decimal_dot",u="string"==r[l].isNumberRounding||"norounding"==r[l].isNumberRounding?-1:parseInt(r[l].isNumberRounding),s="string"!==r[l].isNumberRoundingDirection?r[l].isNumberRoundingDirection:"roundclosest",m="string"!==r[l].isNumberFixedPoint?r[l].isNumberFixedPoint:!1,_=jQuery(".gfield_list_"+a+"_cell"+l+" input"),d=".",f=",";"decimal_comma"==o&&(d=",",f="."),_.attr("autocomplete","off"),console.log("list-field-number-format-for-gravity-forms :: field_id: "+a+" field_column: "+l+" isNumberFormat: "+o+" isNumberRounding: "+u+" isNumberFixedPoint: "+m+" isNumberRoundingDirection: "+s),itsg_setup_total_columns(_,i,a,l,o,u,d,f,m,s),itsg_setup_row_calculations(_,i,a,l,o,u,d,f,m,s),gformInitListNumberFormatFields(_,i,a,l,o,u,d,f,m,s),itsg_setup_range(_,i,a,l,o,u,d,f,m,s),jQuery("li.gfield table.gfield_list tbody tr:not(.isNumberColumnTotalRow)").find(_).each(function(){var e=jQuery(this).val();isFinite(itsg_clean_number(e))&&jQuery(this).trigger("change")})}}}function itsg_setup_row_calculations(field,form_id,field_id,field_column,isNumberFormat,isNumberRounding,decimalSeparator,thousandSeparator,isNumberFixedPoint,isNumberRoundingDirection){var obj=itsg_gf_listnumformat_js_settings.number_format_fields[field_id],destination_column=obj[field_column].isNumberEnableCalculation;void 0!=destination_column&&field.bind("change",{field_id:field_id,field_column:field_column,destination_column:destination_column,destination_forumla:obj[destination_column].isNumberCalculationFormula},function(event){var field_id=event.data.field_id,field_column=event.data.field_column,destination_column=event.data.destination_column,destination_forumla=event.data.destination_forumla,row=jQuery(this).parents("tr.gfield_list_group:not(.isNumberColumnTotalRow)"),destination_field=row.find(".gfield_list_"+field_id+"_cell"+destination_column+" input"),patt=/{[^{]*?:(\d+(\.\d+)?)(:(.*?))?}/i,matches=getMatchGroups(destination_forumla,patt);for(i in matches)if(matches.hasOwnProperty(i)){var inputId=matches[i][1],fieldId=parseInt(inputId),columnId=matches[i][2].substr(1),input=row.find(".gfield_list_"+fieldId+"_cell"+columnId+" input"),value=input.val();value=itsg_clean_number(value,isNumberRounding,decimalSeparator,thousandSeparator,isNumberFixedPoint,isNumberRoundingDirection);var destination_forumla=destination_forumla.replace(matches[i][0],value)}destination_field.not(this).val(eval(destination_forumla)).trigger("change")})}function itsg_setup_range(field,form_id,field_id,field_column,isNumberFormat,isNumberRounding,decimalSeparator,thousandSeparator,isNumberFixedPoint,isNumberRoundingDirection){var text_cannot_be_less_than=itsg_gf_listnumformat_js_settings.text_cannot_be_less_than,text_cannot_be_more_than=itsg_gf_listnumformat_js_settings.text_cannot_be_more_than,obj=itsg_gf_listnumformat_js_settings.number_format_fields[field_id],isNumberRangeMinFormula=void 0!==obj[field_column].isNumberRangeMinFormula?obj[field_column].isNumberRangeMinFormula:"",isNumberRangeMaxFormula=void 0!==obj[field_column].isNumberRangeMaxFormula?obj[field_column].isNumberRangeMaxFormula:"";if(isNumberRangeMinFormula.length>1||isNumberRangeMaxFormula.length>1){var patt=/{[^{]*?:(\d+(\.\d+)?)(:(.*?))?}/i;range_min_error=!1;var isNumberRangeMinFormula_matches=getMatchGroups(isNumberRangeMinFormula,patt);for(i in isNumberRangeMinFormula_matches)if(isNumberRangeMinFormula_matches.hasOwnProperty(i)){var columnId=isNumberRangeMinFormula_matches[i][2].substr(1),isNumberRangeMinFormulaField=jQuery(".gfield_list_"+field_id+"_cell"+columnId+" input, .gfield_list_"+field_id+"_cell"+field_column+" input");isNumberRangeMinFormulaField.bind("change",{field_id:field_id,field_column:field_column,isNumberRangeMinFormula:isNumberRangeMinFormula,obj:obj},function(event){range_min_error=!1;var field_id=event.data.field_id,field_column=event.data.field_column,row=jQuery(this).parents("tr.gfield_list_group"),field=row.find(".gfield_list_"+field_id+"_cell"+field_column+" input"),isNumberRangeMinFormula=event.data.isNumberRangeMinFormula,obj=event.data.obj,value=field.val(),value=itsg_clean_number(value,isNumberRounding,decimalSeparator,thousandSeparator,isNumberFixedPoint,isNumberRoundingDirection),patt=/{[^{]*?:(\d+(\.\d+)?)(:(.*?))?}/i,isNumberRangeMinFormula_matches=getMatchGroups(isNumberRangeMinFormula,patt);for(i in isNumberRangeMinFormula_matches)if(isNumberRangeMinFormula_matches.hasOwnProperty(i))var columnId=isNumberRangeMinFormula_matches[i][2].substr(1),matched_field_column=row.find(".gfield_list_"+field_id+"_cell"+columnId+" input"),value=matched_field_column.val(),matched_field_column_value=itsg_clean_number(value,isNumberRounding,decimalSeparator,thousandSeparator,isNumberFixedPoint,isNumberRoundingDirection),isNumberRangeMinFormula=isNumberRangeMinFormula.replace(isNumberRangeMinFormula_matches[i][0],matched_field_column_value);var isNumberRangeMinFormula_formatted="";isNumberFormat=obj[field_column].isNumberFormat,isNumberRangeMinFormula_formatted=itsg_format_number_field(eval(isNumberRangeMinFormula),isNumberFormat,isNumberRounding,decimalSeparator,thousandSeparator,isNumberFixedPoint,isNumberRoundingDirection),eval(isNumberRangeMinFormula)>value?(range_min_error=!0,field.addClass("range-error"),field.next("div.range-error").remove(),field.after("<div class='range-error'><div class='arrow-up'></div><span class='range-error-flag'>"+text_cannot_be_less_than+" "+isNumberRangeMinFormula_formatted+"</span></div>")):(field.removeClass("range-error"),field.next("div.range-error").remove())})}var isNumberRangeMaxFormula_matches=getMatchGroups(isNumberRangeMaxFormula,patt);for(i in isNumberRangeMaxFormula_matches)if(isNumberRangeMaxFormula_matches.hasOwnProperty(i)){var columnId=isNumberRangeMaxFormula_matches[i][2].substr(1),isNumberRangeMaxFormulaField=jQuery(".gfield_list_"+field_id+"_cell"+columnId+" input, .gfield_list_"+field_id+"_cell"+field_column+" input");isNumberRangeMaxFormulaField.bind("change",{field_id:field_id,field_column:field_column,isNumberRangeMaxFormula:isNumberRangeMaxFormula,obj:obj},function(event){var field_id=event.data.field_id,field_column=event.data.field_column,row=jQuery(this).parents("tr.gfield_list_group"),field=row.find(".gfield_list_"+field_id+"_cell"+field_column+" input"),isNumberRangeMaxFormula=event.data.isNumberRangeMaxFormula,obj=event.data.obj,value=field.val(),value=itsg_clean_number(value,isNumberRounding,decimalSeparator,thousandSeparator,isNumberFixedPoint,isNumberRoundingDirection),patt=/{[^{]*?:(\d+(\.\d+)?)(:(.*?))?}/i,isNumberRangeMaxFormula_matches=getMatchGroups(isNumberRangeMaxFormula,patt);for(i in isNumberRangeMaxFormula_matches)if(isNumberRangeMaxFormula_matches.hasOwnProperty(i))var columnId=isNumberRangeMaxFormula_matches[i][2].substr(1),matched_field_column=row.find(".gfield_list_"+field_id+"_cell"+columnId+" input"),matched_field_value=matched_field_column.val(),matched_field_column_value=itsg_clean_number(matched_field_value,isNumberRounding,decimalSeparator,thousandSeparator,isNumberFixedPoint,isNumberRoundingDirection),isNumberRangeMaxFormula=isNumberRangeMaxFormula.replace(isNumberRangeMaxFormula_matches[i][0],matched_field_column_value);var isNumberRangeMaxFormula_formatted="";isNumberFormat=obj[field_column].isNumberFormat,isNumberRangeMaxFormula_formatted=itsg_format_number_field(eval(isNumberRangeMaxFormula),isNumberFormat,isNumberRounding,decimalSeparator,thousandSeparator,isNumberFixedPoint,isNumberRoundingDirection),!range_min_error&&eval(isNumberRangeMaxFormula)<value?(field.addClass("range-error"),field.next("div.range-error").remove(),field.after("<div class='range-error'><div class='arrow-up'></div><span class='range-error-flag'>"+text_cannot_be_more_than+" "+isNumberRangeMaxFormula_formatted+"</span></div>")):range_min_error||(field.removeClass("range-error"),field.next("div.range-error").remove())})}}}function itsg_setup_total_columns(e,i,t,r,n,a,l,o,u,s){var m=itsg_gf_listnumformat_js_settings.number_format_fields[t],_="string"!==m[r].isNumberColumnTotal?m[r].isNumberColumnTotal:!1;if("true"==_&&!jQuery("#field_"+i+"_"+t+" div.ginput_container table tbody tr:last-child").hasClass("isNumberColumnTotalRow")){jQuery("#field_"+i+"_"+t+" div.ginput_container table tbody tr:last-child").clone().insertAfter("#field_"+i+"_"+t+" div.ginput_container table tbody tr:last-child").addClass("isNumberColumnTotalRow").removeClass("gfield_list_group gfield_list_row_odd gfield_list_row_even"),jQuery("#field_"+i+"_"+t+" div.ginput_container table tbody tr:last-child").find("input:not(.isNumberColumnTotal), select:not(.isNumberColumnTotal), .gfield_list_icons img").parent().empty(),jQuery("#field_"+i+"_"+t+" div.ginput_container table tbody tr:last-child").find(".gfield_list_"+t+"_cell"+r).removeClass("gfield_list_"+t+"_cell"+r),jQuery("#field_"+i+"_"+t+" div.ginput_container table tbody tr:last-child").find("input").prop("readonly",!0).removeAttr("tabindex").removeAttr("name"),jQuery("#field_"+i+"_"+t+" div.ginput_container table tbody tr:last-child").find("input.isNumberColumnTotal").next("div.instruction").empty(),jQuery("#field_"+i+"_"+t+" div.ginput_container table").addClass("isNumberColumnTotalRow");var e=jQuery(".gfield_list_"+t+"_cell"+r+" input");calc_column_total(e,i,t,r,n,a,l,o,u,s)}}function itsg_gf_list_number_format_newrow(e,i){var t=i.parents("table.gfield_list_container").prev("input").attr("id").split("_"),r=t[t.length-2],n=itsg_gf_listnumformat_js_settings.form_id;e.find(".gfield_list_cell input.decimal_dot, .gfield_list_cell input.decimal_comma, .gfield_list_cell input.currency").each(function(){var e=jQuery(this),i=e.parent("td.gfield_list_cell").index()+1,t=itsg_gf_listnumformat_js_settings.number_format_fields,a=t[r][i].isNumberFormat,l=t[r][i].isNumberRounding,o=t[r][i].isNumberFixedPoint,u=t[r][i].isNumberRoundingDirection,s=".",m=",";"decimal_comma"==a&&(s=",",m="."),gformInitListNumberFormatFields(e,n,r,i,a,l,s,m,o,u),itsg_setup_range(e,n,r,i,a,l,s,m,o,u),itsg_setup_row_calculations(e,n,r,i,a,l,s,m,o,u),itsg_setup_total_columns(e,n,r,i,a,l,s,m,o,u)})}function gformInitListNumberFormatFields(e,i,t,r,n,a,l,o,u,s){jQuery(e).keyup(function(){jQuery(this).hasClass("isNumberColumnTotal")&&calc_column_total(e,i,t,r,n,a,l,o,u,s)}),jQuery(e).each(function(){jQuery(this).change(function(){var e=jQuery(this);if(""!=e.val()&&"0"!=e.val()){var i=e.val();i=itsg_format_number_field(i,n,a,l,o,u,s),e.val(i).trigger("keyup")}})})}function calc_column_total(e,i,t,r,n,a,l,o,u,s){var e=jQuery(".gfield_list_"+t+"_cell"+r+" input"),m=0;"currency"==n?(jQuery("table.gfield_list_container tbody tr:not(.isNumberColumnTotalRow)").find(e).each(function(){var e=jQuery(this).val();e=itsg_clean_number(e,a,l,o,u,s),m+=e}),m=itsg_format_number_field(m,n,a,l,o,u,s)):(jQuery("li.gfield table.gfield_list tbody tr:not(.isNumberColumnTotalRow)").find(e).each(function(){var e=jQuery(this).val();e=itsg_clean_number(e,a,l,o,u,s),m+=parseFloat(e)}),m=itsg_format_number_field(m,n,a,l,o,u,s)),jQuery("#field_"+i+"_"+t+" div.ginput_container table tr.isNumberColumnTotalRow").find("td:nth-child("+r+") input").val(m)}function itsg_format_number_field(e,i,t,r,n,a,l){void 0==e&&(e=0),0==e.length&&(e=0),e=e.toString();var o=(e.split(r)[1]||[]).length;-1==t&&(t=(e.split(r)[1]||[]).length);var u=itsg_clean_number(e,t,r,n,a,l);return"currency"==i?(e=gformFormatMoney(u),e=itsg_force_rounding(e,t,r,n,a,l)):(e=gformFormatNumber(u,o,r,n),e=itsg_force_rounding(e,t,r,n,a,l)),e}function create_length_number(e,i){return e.length<i+1?create_length_number(e+"0",i):e}function itsg_force_rounding(e,i,t,r,n,a){var l=(e.split(t)[1]||[]).length;if(n&&i>l)for(-1==e.indexOf(t)&&(e+=t);i>l;)e+="0",l=e.substr(e.indexOf(t)+1).length;return-1==i&&(i=(e.split(t)[1]||[]).length),e}function toFixed(e,i){return(+(Math.round(+(e+"e"+i))+"e"+-i)).toFixed(i)}function itsg_clean_number(e,i,t,r,n,a){var e=e.replace(/(?![.,])[\D+]/g,"");if(","==t&&(e=e.replace(/\./g,"").replace(/\,/g,".")),e=e.replace(/\,/g,""),"rounddown"==a)var l=create_length_number("1",i),e=Math.floor(e*l)/l;else if("roundup"==a)var l=create_length_number("1",i),e=Math.ceil(e*l)/l;else if("roundclosest"==a){var e=parseFloat(e);-1!=i&&(e=e.toFixed(i))}return e=e.toString(),isFinite(e)||(e=0),parseFloat(e)}function itsg_gf_list_number_format_clean_row(e){e.find("div.range-error").remove(),e.find("input.range-error").removeClass("range-error")}jQuery(".gfield_list").on("click",".add_list_item,.delete_list_item",function(){var e=jQuery(this).parents("tr.gfield_list_group").next("tr.gfield_list_group");itsg_gf_list_number_format_clean_row(e)}),"1"==itsg_gf_listnumformat_js_settings.is_entry_detail?jQuery(document).ready(function(e){itsg_gf_list_number_format_init(),gform.addFilter("gform_list_item_pre_add",function(e,i){return itsg_gf_list_number_format_newrow(e,i),e});var i=gformDeleteListItem;gformDeleteListItem=function(e,t){var r=jQuery(e).parents(".gfield_list_container"),n=i.apply(this,[e,t]);return r.find("tr.gfield_list_group:first input.isNumberColumnTotal").each(function(){jQuery(this).trigger("keyup")}),n}}):jQuery(document).bind("gform_post_render",function(e){itsg_gf_list_number_format_init(),gform.addFilter("gform_list_item_pre_add",function(e,i){return itsg_gf_list_number_format_newrow(e,i),e});var i=gformDeleteListItem;gformDeleteListItem=function(e,t){var r=jQuery(e).parents(".gfield_list_container"),n=i.apply(this,[e,t]);return r.find("tr.gfield_list_group:first input.isNumberColumnTotal").each(function(){jQuery(this).trigger("keyup")}),n}});