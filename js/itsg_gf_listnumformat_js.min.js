function itsg_gf_list_number_format_init(){var e=itsg_gf_listnumformat_js_settings.number_format_fields,i=itsg_gf_listnumformat_js_settings.form_id;for(var r in e)if(e.hasOwnProperty(r)){var t=e[r];for(var n in t)if(t.hasOwnProperty(n)){var a=r,l=n,o="string"!==t[l].isNumberFormat?t[l].isNumberFormat:"decimal_dot",u="string"==t[l].isNumberRounding||"norounding"==t[l].isNumberRounding?-1:parseInt(t[l].isNumberRounding),s="string"!==t[l].isNumberRoundingDirection?t[l].isNumberRoundingDirection:"roundclosest",m="string"!==t[l].isNumberFixedPoint?t[l].isNumberFixedPoint:!1,_=t[l].isNumberCalculationFormula,d=jQuery(".gfield_list_"+a+"_cell"+l+" input");if(d.length){var g=".",f=",";"decimal_comma"==o&&(g=",",f="."),d.attr("autocomplete","off"),console.log("list-field-number-format-for-gravity-forms :: field_id: "+a+" field_column: "+l+" isNumberFormat: "+o+" isNumberRounding: "+u+" isNumberFixedPoint: "+m+" isNumberRoundingDirection: "+s+" isNumberCalculationFormula: "+_),itsg_setup_total_columns(d,i,a,l,o,u,g,f,m,s),"string"!==_&&itsg_setup_row_calculations(d,i,a,l,o,u,g,f,m,s),gformInitListNumberFormatFields(d,i,a,l,o,u,g,f,m,s),itsg_setup_range(d,i,a,l,o,u,g,f,m,s),jQuery("li.gfield table.gfield_list tbody tr:not(.isNumberColumnTotalRow)").find(d).each(function(){var e=jQuery(this).val();isFinite(itsg_clean_number(e))&&jQuery(this).trigger("change")})}}}}function itsg_setup_row_calculations(field,form_id,field_id,field_column,isNumberFormat,isNumberRounding,decimalSeparator,thousandSeparator,isNumberFixedPoint,isNumberRoundingDirection){var obj=itsg_gf_listnumformat_js_settings.number_format_fields[field_id],destination_column=field_column,destination_forumla=obj[destination_column].isNumberCalculationFormula,row=field.parents("tr.gfield_list_group:not(.isNumberColumnTotalRow)"),patt=/{[^{]*?:(\d+(\.\d+)?)(:(.*?))?}/i,matches=getMatchGroups(destination_forumla,patt);for(i in matches)if(matches.hasOwnProperty(i)){var inputId=matches[i][1],fieldId=parseInt(inputId);if(void 0!==matches[i][2])var columnId=matches[i][2].substr(1),input=row.find(".gfield_list_"+fieldId+"_cell"+columnId+" input");else var input=jQuery("#input_"+form_id+"_"+fieldId);input.bind("change",{destination_column:destination_column,matches:matches},function(event){var destination_forumla=obj[destination_column].isNumberCalculationFormula,matches=event.data.matches;for(i in matches)if(matches.hasOwnProperty(i)){var inputId=matches[i][1],fieldId=parseInt(inputId);if(void 0!==matches[i][2])var columnId=matches[i][2].substr(1),input=row.find(".gfield_list_"+fieldId+"_cell"+columnId+" input");else var input=jQuery("#input_"+form_id+"_"+fieldId);var value=input.val();value=itsg_clean_number(value,isNumberRounding,decimalSeparator,thousandSeparator,isNumberFixedPoint,isNumberRoundingDirection),destination_forumla=destination_forumla.replace(matches[i][0],value);var r=new RegExp("^[0-9 -/*()]+$");if(r.test(destination_forumla)){var value=itsg_format_number_field(eval(destination_forumla),isNumberFormat,isNumberRounding,decimalSeparator,thousandSeparator,isNumberFixedPoint,isNumberRoundingDirection);field.val(value).trigger("change")}}})}}function itsg_setup_range(field,form_id,field_id,field_column,isNumberFormat,isNumberRounding,decimalSeparator,thousandSeparator,isNumberFixedPoint,isNumberRoundingDirection){var text_cannot_be_less_than=itsg_gf_listnumformat_js_settings.text_cannot_be_less_than,text_cannot_be_more_than=itsg_gf_listnumformat_js_settings.text_cannot_be_more_than,obj=itsg_gf_listnumformat_js_settings.number_format_fields[field_id],isNumberRangeMinFormula=void 0!==obj[field_column].isNumberRangeMinFormula?obj[field_column].isNumberRangeMinFormula:"",isNumberRangeMaxFormula=void 0!==obj[field_column].isNumberRangeMaxFormula?obj[field_column].isNumberRangeMaxFormula:"";if(isNumberRangeMinFormula.length>1||isNumberRangeMaxFormula.length>1){var patt=/{[^{]*?:(\d+(\.\d+)?)(:(.*?))?}/i;range_min_error=!1;var isNumberRangeMinFormula_matches=getMatchGroups(isNumberRangeMinFormula,patt);for(i in isNumberRangeMinFormula_matches)if(isNumberRangeMinFormula_matches.hasOwnProperty(i)){var columnId=isNumberRangeMinFormula_matches[i][2].substr(1),isNumberRangeMinFormulaField=jQuery(".gfield_list_"+field_id+"_cell"+columnId+" input, .gfield_list_"+field_id+"_cell"+field_column+" input");isNumberRangeMinFormulaField.bind("change",{field_id:field_id,field_column:field_column,isNumberRangeMinFormula:isNumberRangeMinFormula,obj:obj},function(event){range_min_error=!1;var field_id=event.data.field_id,field_column=event.data.field_column,row=jQuery(this).parents("tr.gfield_list_group"),field=row.find(".gfield_list_"+field_id+"_cell"+field_column+" input"),isNumberRangeMinFormula=event.data.isNumberRangeMinFormula,obj=event.data.obj,value=field.val(),value=itsg_clean_number(value,isNumberRounding,decimalSeparator,thousandSeparator,isNumberFixedPoint,isNumberRoundingDirection),patt=/{[^{]*?:(\d+(\.\d+)?)(:(.*?))?}/i,isNumberRangeMinFormula_matches=getMatchGroups(isNumberRangeMinFormula,patt);for(i in isNumberRangeMinFormula_matches)if(isNumberRangeMinFormula_matches.hasOwnProperty(i))var columnId=isNumberRangeMinFormula_matches[i][2].substr(1),matched_field_column=row.find(".gfield_list_"+field_id+"_cell"+columnId+" input"),value=matched_field_column.val(),matched_field_column_value=itsg_clean_number(value,isNumberRounding,decimalSeparator,thousandSeparator,isNumberFixedPoint,isNumberRoundingDirection),isNumberRangeMinFormula=isNumberRangeMinFormula.replace(isNumberRangeMinFormula_matches[i][0],matched_field_column_value);var isNumberRangeMinFormula_formatted="";isNumberFormat=obj[field_column].isNumberFormat,isNumberRangeMinFormula_formatted=itsg_format_number_field(eval(isNumberRangeMinFormula),isNumberFormat,isNumberRounding,decimalSeparator,thousandSeparator,isNumberFixedPoint,isNumberRoundingDirection),eval(isNumberRangeMinFormula)>value?(range_min_error=!0,field.addClass("range-error"),field.next("div.range-error").remove(),field.after("<div class='range-error'><div class='arrow-up'></div><span class='range-error-flag'>"+text_cannot_be_less_than+" "+isNumberRangeMinFormula_formatted+"</span></div>")):(field.removeClass("range-error"),field.next("div.range-error").remove())})}var isNumberRangeMaxFormula_matches=getMatchGroups(isNumberRangeMaxFormula,patt);for(i in isNumberRangeMaxFormula_matches)if(isNumberRangeMaxFormula_matches.hasOwnProperty(i)){var columnId=isNumberRangeMaxFormula_matches[i][2].substr(1),isNumberRangeMaxFormulaField=jQuery(".gfield_list_"+field_id+"_cell"+columnId+" input, .gfield_list_"+field_id+"_cell"+field_column+" input");isNumberRangeMaxFormulaField.bind("change",{field_id:field_id,field_column:field_column,isNumberRangeMaxFormula:isNumberRangeMaxFormula,obj:obj},function(event){var field_id=event.data.field_id,field_column=event.data.field_column,row=jQuery(this).parents("tr.gfield_list_group"),field=row.find(".gfield_list_"+field_id+"_cell"+field_column+" input"),isNumberRangeMaxFormula=event.data.isNumberRangeMaxFormula,obj=event.data.obj,value=field.val(),value=itsg_clean_number(value,isNumberRounding,decimalSeparator,thousandSeparator,isNumberFixedPoint,isNumberRoundingDirection),patt=/{[^{]*?:(\d+(\.\d+)?)(:(.*?))?}/i,isNumberRangeMaxFormula_matches=getMatchGroups(isNumberRangeMaxFormula,patt);for(i in isNumberRangeMaxFormula_matches)if(isNumberRangeMaxFormula_matches.hasOwnProperty(i))var columnId=isNumberRangeMaxFormula_matches[i][2].substr(1),matched_field_column=row.find(".gfield_list_"+field_id+"_cell"+columnId+" input"),matched_field_value=matched_field_column.val(),matched_field_column_value=itsg_clean_number(matched_field_value,isNumberRounding,decimalSeparator,thousandSeparator,isNumberFixedPoint,isNumberRoundingDirection),isNumberRangeMaxFormula=isNumberRangeMaxFormula.replace(isNumberRangeMaxFormula_matches[i][0],matched_field_column_value);var isNumberRangeMaxFormula_formatted="";isNumberFormat=obj[field_column].isNumberFormat,isNumberRangeMaxFormula_formatted=itsg_format_number_field(eval(isNumberRangeMaxFormula),isNumberFormat,isNumberRounding,decimalSeparator,thousandSeparator,isNumberFixedPoint,isNumberRoundingDirection),!range_min_error&&eval(isNumberRangeMaxFormula)<value?(field.addClass("range-error"),field.next("div.range-error").remove(),field.after("<div class='range-error'><div class='arrow-up'></div><span class='range-error-flag'>"+text_cannot_be_more_than+" "+isNumberRangeMaxFormula_formatted+"</span></div>")):range_min_error||(field.removeClass("range-error"),field.next("div.range-error").remove())})}}}function itsg_setup_total_columns(e,i,r,t,n,a,l,o,u,s){var m=itsg_gf_listnumformat_js_settings.number_format_fields[r],_="string"!==m[t].isNumberColumnTotal?m[t].isNumberColumnTotal:!1;if("true"==_&&!jQuery("#field_"+i+"_"+r+" div.ginput_container table tbody:last-of-type tr:last-child").hasClass("isNumberColumnTotalRow")){jQuery("#field_"+i+"_"+r+" div.ginput_container table tbody tr:last-child").clone().insertAfter("#field_"+i+"_"+r+" div.ginput_container table tbody").addClass("isNumberColumnTotalRow").removeClass("gfield_list_group gfield_list_row_odd gfield_list_row_even").wrap("<tbody>");var d=jQuery("#field_"+i+"_"+r+" div.ginput_container table tbody tr.isNumberColumnTotalRow");d.find("input:not(.isNumberColumnTotal), select:not(.isNumberColumnTotal), .gfield_list_icons img").parent().empty(),d.find(".gfield_list_"+r+"_cell"+t).removeClass("gfield_list_"+r+"_cell"+t),d.find("input").prop("readonly",!0).removeAttr("tabindex").removeAttr("name"),d.find("input.isNumberColumnTotal").next("div.instruction").empty(),jQuery("#field_"+i+"_"+r+" div.ginput_container table").addClass("isNumberColumnTotalRow ");var e=jQuery(".gfield_list_"+r+"_cell"+t+" input");calc_column_total(e,i,r,t,n,a,l,o,u,s)}}function itsg_gf_list_number_format_newrow(e,i){if("1"==itsg_gf_listnumformat_js_settings.is_entry_detail)var r=i.parents("table.gfield_list_container").prev("input").attr("id").split("_"),t=r[r.length-2];else var r=i.parents("li.gfield").attr("id").split("_"),t=r[r.length-1];var n=itsg_gf_listnumformat_js_settings.form_id;e.find(".gfield_list_cell input.decimal_dot, .gfield_list_cell input.decimal_comma, .gfield_list_cell input.currency").each(function(){var e=jQuery(this),i=e.parent("td.gfield_list_cell").index()+1,r=itsg_gf_listnumformat_js_settings.number_format_fields,a="string"!==r[t][i].isNumberFormat?r[t][i].isNumberFormat:"decimal_dot",l="string"==r[t][i].isNumberRounding||"norounding"==r[t][i].isNumberRounding?-1:parseInt(r[t][i].isNumberRounding),o="string"!==r[t][i].isNumberFixedPoint?r[t][i].isNumberFixedPoint:!1,u="string"!==r[t][i].isNumberRoundingDirection?r[t][i].isNumberRoundingDirection:"roundclosest",s=r[t][i].isNumberCalculationFormula,m=".",_=",";"decimal_comma"==a&&(m=",",_="."),gformInitListNumberFormatFields(e,n,t,i,a,l,m,_,o,u),itsg_setup_range(e,n,t,i,a,l,m,_,o,u),"string"!==s&&itsg_setup_row_calculations(e,n,t,i,a,l,m,_,o,u),itsg_setup_total_columns(e,n,t,i,a,l,m,_,o,u)})}function gformInitListNumberFormatFields(e,i,r,t,n,a,l,o,u,s){jQuery(e).keyup(function(){jQuery(this).hasClass("isNumberColumnTotal")&&calc_column_total(e,i,r,t,n,a,l,o,u,s)}),jQuery(e).each(function(){jQuery(this).change(function(){var e=jQuery(this);if(""!=e.val()&&"0"!=e.val()){var i=e.val(),r=itsg_clean_number(i,a,l,o,u,s),i=itsg_format_number_field(r,n,a,l,o,u,s);e.val(i).trigger("keyup")}})})}function calc_column_total(e,i,r,t,n,a,l,o,u,s){var e=jQuery(".gfield_list_"+r+"_cell"+t+" input"),m=0;"currency"==n?(jQuery("table.gfield_list_container tbody tr:not(.isNumberColumnTotalRow)").find(e).each(function(){var e=jQuery(this).val();e=itsg_clean_number(e,a,l,o,u,s),m+=e}),m=itsg_format_number_field(m,n,a,l,o,u,s)):(jQuery("li.gfield table.gfield_list tbody tr:not(.isNumberColumnTotalRow)").find(e).each(function(){var e=jQuery(this).val();e=itsg_clean_number(e,a,l,o,u,s),m+=parseFloat(e)}),m=itsg_format_number_field(m,n,a,l,o,u,s)),jQuery("#field_"+i+"_"+r+" div.ginput_container table tr.isNumberColumnTotalRow").find("td:nth-child("+t+") input").val(m)}function itsg_format_number_field(e,i,r,t,n,a,l){void 0==e&&(e=0),0==e.length&&(e=0),e=e.toString();var o=(e.split(".")[1]||[]).length;return-1==r&&(r=(e.split(".")[1]||[]).length),"currency"==i?(value=gformFormatMoney(e),value=itsg_force_rounding(value,r,t,n,a,l)):(value=gformFormatNumber(e,o,t,n),value=itsg_force_rounding(value,r,t,n,a,l)),value}function create_length_number(e,i){return e.length<i+1?create_length_number(e+"0",i):e}function itsg_force_rounding(e,i,r,t,n,a){var l=(e.split(r)[1]||[]).length;if(n&&i>l)for(-1==e.indexOf(r)&&(e+=r);i>l;)e+="0",l=e.substr(e.indexOf(r)+1).length;return-1==i&&(i=(e.split(r)[1]||[]).length),e}function toFixed(e,i){return(+(Math.round(+(e+"e"+i))+"e"+-i)).toFixed(i)}function itsg_clean_number(e,i,r,t,n,a){var e=e.replace(/(?![.,-])[\D+]/g,"");if(","==r&&(e=e.replace(/\./g,"").replace(/\,/g,".")),e=e.replace(/\,/g,""),!gformIsNumber(e))var e=0;if("rounddown"==a)var l=create_length_number("1",i),e=Math.floor(e*l)/l;else if("roundup"==a)var l=create_length_number("1",i),e=Math.ceil(e*l)/l;else if("roundclosest"==a){var e=parseFloat(e);-1!=i&&(e=e.toFixed(i))}return e=e.toString(),isFinite(e)||(e=0),parseFloat(e)}function itsg_gf_list_number_format_clean_row(e){e.find("div.range-error").remove(),e.find("input.range-error").removeClass("range-error")}jQuery(".gfield_list").on("click",".add_list_item,.delete_list_item",function(){var e=jQuery(this).parents("tr.gfield_list_group").next("tr.gfield_list_group");itsg_gf_list_number_format_clean_row(e)}),"1"==itsg_gf_listnumformat_js_settings.is_entry_detail?jQuery(document).ready(function(e){itsg_gf_list_number_format_init(),gform.addFilter("gform_list_item_pre_add",function(e,i){return itsg_gf_list_number_format_newrow(e,i),e});var i=gformDeleteListItem;gformDeleteListItem=function(e,r){var t=jQuery(e).parents(".gfield_list_container"),n=i.apply(this,[e,r]);return t.find("tr.gfield_list_group:first input.isNumberColumnTotal").each(function(){jQuery(this).trigger("keyup")}),n}}):jQuery(document).bind("gform_post_render",function(e){itsg_gf_list_number_format_init(),gform.addFilter("gform_list_item_pre_add",function(e,i){return itsg_gf_list_number_format_newrow(e,i),e});var i=gformDeleteListItem;gformDeleteListItem=function(e,r){var t=jQuery(e).parents(".gfield_list_container"),n=i.apply(this,[e,r]);return t.find("tr.gfield_list_group:first input.isNumberColumnTotal").each(function(){jQuery(this).trigger("keyup")}),n}});